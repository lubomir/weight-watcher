<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Weight Watcher</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/dygraph-combined.js"></script>
<style>
.dygraph-axis-label.dygraph-axis-label-x {
    width: 60px;
    font-size: 10px;
}
.dygraph-rangesel-fgcanvas, .dygraph-rangesel-bgcanvas, .dygraph-rangesel-zoomhandle {
    margin-top: 1em;
}
</style>
</head>
<body>
<div id="graphdiv"
  style="width:95%; height:85%;"></div>
<script type="text/javascript">
  $.get("/data.json").success(function(data) {
          var alpha = 0.1;
          var d = [];
          var avg = 0;
          for (var i = 0, len = data.length; i < len; i++) {
              if (i == 0) {
                avg = data[i]['weight'];
              } else {
                avg = alpha * data[i]['weight'] + (1 - alpha) * avg;
                //avg = avg + 0.1 * (data[i]['weight'] - avg);
              }
              d.push([new Date(data[i]['date']), data[i]['weight'], avg])
          };
  g = new Dygraph(
    document.getElementById("graphdiv"),
    d,
    {
        showRangeSelector: true,
        rightGap: 6,
        leftGap: 6,
        pointSize: 2,
        panEdgeFraction: 0.01,
        labels: ['Date', 'Weight', 'Avg'],
        "Weight": {
            drawPoints: true,
            strokeWidth: 0
        },
        axes: {
            x: {
                axisLabelFormatter: function(x, gran) {
                    var months = ['led', 'ún', 'bře', 'dub', 'kvě', 'čer',
                    'čec', 'srp', 'zář', 'říj', 'lis', 'pro'];
                    switch (gran) {
                    case Dygraph.MONTHLY:
                        return months[x.getMonth()] + "<br>" + x.getFullYear();
                    case Dygraph.YEARLY:
                        return x.getFullYear();
                    }
                    var day = x.getDate();
                    return day + ".&nbsp;" + months[x.getMonth()] + "<br>" + x.getFullYear();
                }
            }
        }
    }
  );
  g.ready(function() {
      var num = g.numRows();
      if (num >= 28) {
          var last = g.getValue(num - 1, 0);
          var first = g.getValue(num > 28 ? num - 28 : 0, 0);
          g.updateOptions({dateWindow: [first, 1.01 * last - 0.01 * first]});
      }
  });
  });
</script>
</body>
</html>
